openapi: 3.0.3
info:
  title: Murder Mystery MVP API
  version: 0.1.0
  description: >
    MVP backend API for AI-generated murder mystery game.
    Face-to-face play, minimal endpoints.

servers:
  - url: http://localhost:8080

paths:
  /sessions:
    post:
      summary: Create new game session
      operationId: postSessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSessionRequest"
      responses:
        "200":
          description: Session created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateSessionResponse"

  /sessions/{sessionId}/players:
    post:
      summary: Join a game session
      operationId: postSessionPlayers
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JoinPlayerRequest"
      responses:
        "200":
          description: Player joined
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JoinPlayerResponse"

  /sessions/{sessionId}/phase:
    get:
      summary: Get current phase information
      operationId: getSessionPhase
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
        - name: X-Player-Id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Phase information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PhaseResponse"

  /sessions/{sessionId}/advance:
    post:
      summary: Advance game phase (GM use)
      operationId: postSessionAdvance
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Phase advanced
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdvancePhaseResponse"

components:
  schemas:
    CreateSessionRequest:
      type: object
      required:
        - playerCount
        - difficulty
      properties:
        playerCount:
          type: integer
          enum: [4, 5]
        difficulty:
          type: string
          enum: [easy, medium, hard]

    CreateSessionResponse:
      type: object
      required:
        - sessionId
      properties:
        sessionId:
          type: string
          example: "session_123"

    JoinPlayerRequest:
      type: object
      required:
        - playerName
      properties:
        playerName:
          type: string
          example: "Player A"

    JoinPlayerResponse:
      type: object
      required:
        - playerId
        - roleId
      properties:
        playerId:
          type: string
          example: "player_1"
        roleId:
          type: string
          example: "p1"

    PhaseResponse:
      type: object
      required:
        - phase
        - gmText
      properties:
        phase:
          type: string
          enum:
            - intro
            - investigation1
            - investigation2
            - discussion
            - voting
            - ending
        gmText:
          type: string
        publicInfo:
          type: string
          nullable: true
        privateInfo:
          type: string
          nullable: true

    AdvancePhaseResponse:
      type: object
      required:
        - phase
      properties:
        phase:
          type: string
          enum:
            - intro
            - investigation1
            - investigation2
            - discussion
            - voting
            - ending
